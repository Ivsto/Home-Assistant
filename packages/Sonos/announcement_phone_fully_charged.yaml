#================
#=== Scripts
#================
script:

  #==================================
  #=== Announce phone fully charged
  #=== passed {{ name }} 
  #==================================
  announcement_phone_fully_charged:
    sequence:

      - service: script.tts_get_greeting

      #=== Setup announcement parameters (Room, Volume, Voice, Priority, Pause and Last Message indicator)
      - service: script.setup_announcement_parameters
        data:
          room:
            - dining_room
          volume: 0.4
          voice: google_translate
          priority: 'off'
          pause: 0
          last_message: 'on'

      - wait_template: "{{ is_state('script.setup_announcement_parameters', 'off') }}"

      #=== Prepare Sonos devices (Snapshot, Unjoin, Join and set Volume)
      - service: script.prepare_sonos_media_players

      - wait_template: "{{ is_state('script.prepare_sonos_media_players', 'off') }}"
    
      #=== Publish announcement
      - service: mqtt.publish
        data_template:
          topic: notifications/announcement
          payload_template: >
            {{ states('input_text.tts_greeting') }}. {{ name | title }}s phone is now fully charged.

